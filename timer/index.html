<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Pomodoro Timer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Theme: Teal Ocean (Default) - 톤다운 */
    :root {
      --primary-bg: #f8fdfb;
      --secondary-bg: #ffffff;
      --card-bg: rgba(255, 255, 255, 0.85);
      --text-primary: #0f3c38;
      --text-secondary: #155e56;
      --text-muted: #7dd3d8;
      --accent-primary: #2ba3b3;
      --accent-secondary: #5bc5d3;
      --accent-focus: #1a8fa1;
      --accent-break: #16748a;
      --border-color: #c7f0e8;
      --shadow-light: 0 4px 20px rgba(43, 163, 179, 0.12);
      --shadow-medium: 0 8px 32px rgba(43, 163, 179, 0.18);
      --border-radius: 16px;
      --border-radius-small: 8px;
    }

    /* Theme: Pink Sunset */
    [data-theme="pink"] {
      --primary-bg: #fef7f7;
      --secondary-bg: #ffffff;
      --card-bg: rgba(255, 255, 255, 0.85);
      --text-primary: #881337;
      --text-secondary: #be185d;
      --text-muted: #f9a8d4;
      --accent-primary: #ee6d8a;
      --accent-secondary: #f472b6;
      --accent-focus: #ec4899;
      --accent-break: #db2777;
      --border-color: #fce7f3;
      --shadow-light: 0 4px 20px rgba(238, 109, 138, 0.15);
      --shadow-medium: 0 8px 32px rgba(238, 109, 138, 0.25);
    }

    /* Theme: Warm Brown */
    [data-theme="brown"] {
      --primary-bg: #fafaf9;
      --secondary-bg: #ffffff;
      --card-bg: rgba(255, 255, 255, 0.85);
      --text-primary: #44403c;
      --text-secondary: #78716c;
      --text-muted: #d6d3d1;
      --accent-primary: #a59a8b;
      --accent-secondary: #d4c4b0;
      --accent-focus: #92817a;
      --accent-break: #7c6f64;
      --border-color: #e7e5e4;
      --shadow-light: 0 4px 20px rgba(165, 154, 139, 0.15);
      --shadow-medium: 0 8px 32px rgba(165, 154, 139, 0.25);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --primary-bg: #0a2e2c;
        --secondary-bg: #0f3c38;
        --card-bg: rgba(15, 60, 56, 0.8);
        --text-primary: #d1f2ea;
        --text-secondary: #a7e6d7;
        --text-muted: #7dd3d8;
        --border-color: #155e56;
        --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.2);
        --shadow-medium: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      [data-theme="pink"] {
        --primary-bg: #4c0519;
        --secondary-bg: #881337;
        --card-bg: rgba(136, 19, 55, 0.8);
        --text-primary: #fce7f3;
        --text-secondary: #f9a8d4;
        --text-muted: #f472b6;
        --border-color: #be185d;
      }

      [data-theme="brown"] {
        --primary-bg: #292524;
        --secondary-bg: #44403c;
        --card-bg: rgba(68, 64, 60, 0.8);
        --text-primary: #fafaf9;
        --text-secondary: #e7e5e4;
        --text-muted: #d6d3d1;
        --border-color: #78716c;
      }
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--primary-bg) 0%, #f8fafc 100%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      padding: 1rem;
      transition: all 0.3s ease;
    }

    /* Theme Selector */
    .theme-selector {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      z-index: 1000;
      display: flex;
      gap: 0.5rem;
      background: transparent;
      padding: 0;
    }

    .theme-btn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.8);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .theme-btn:hover {
      transform: scale(1.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    }

    .theme-btn.active {
      transform: scale(1.4);
      border-color: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.4), 0 4px 12px rgba(0, 0, 0, 0.25);
    }

    .theme-btn[data-theme="teal"] {
      background: linear-gradient(45deg, #2ba3b3, #5bc5d3);
    }

    .theme-btn[data-theme="brown"] {
      background: linear-gradient(45deg, #a59a8b, #d4c4b0);
    }

    .theme-btn[data-theme="pink"] {
      background: linear-gradient(45deg, #ee6d8a, #f472b6);
    }

    .main-container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 2rem;
      align-items: start;
    }

    /* Card Styling */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      padding: 2rem;
      box-shadow: var(--shadow-light);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-medium);
      transform: translateY(-2px);
    }

    .card-title {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--accent-primary);
      margin-bottom: 1.5rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Timer Section */
    .timer-section {
      position: sticky;
      top: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .circle-timer {
      width: 240px;
      height: 240px;
      margin: 2rem 0;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-display {
      font-size: 2.5rem;
      font-weight: 600;
      color: var(--text-primary);
      font-family: 'Plus Jakarta Sans', sans-serif;
      text-align: center;
    }

    .timer-status {
      text-align: center;
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      background: rgba(124, 131, 253, 0.1);
      border-radius: 20px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Controls */
    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: 100%;
      align-items: center;
    }

    .button-group {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--border-radius-small);
      font-size: 0.95rem;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--secondary-bg);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn:hover {
      background: var(--accent-primary);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(124, 131, 253, 0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--accent-secondary), #b8fff9);
      transform: translateY(-2px);
    }

    .select-input {
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-small);
      background: var(--secondary-bg);
      color: var(--text-primary);
      font-size: 0.95rem;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 120px;
    }

    .select-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(124, 131, 253, 0.1);
    }

    /* Ambient Sound Section */
    .ambient-section {
      margin-top: 1.5rem;
      text-align: center;
    }

    .ambient-toggle {
      background: none;
      border: none;
      color: var(--accent-primary);
      font-size: 1rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--border-radius-small);
      transition: all 0.2s ease;
    }

    .ambient-toggle:hover {
      background: rgba(124, 131, 253, 0.1);
    }

    .ambient-grid {
      display: none;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-top: 1rem;
    }

    .ambient-item {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-small);
      padding: 1rem;
      text-align: center;
      transition: all 0.2s ease;
    }

    .ambient-item:hover {
      background: var(--accent-primary);
      color: white;
      transform: translateY(-2px);
    }

    .ambient-item iframe {
      width: 100%;
      height: 30px;
      border: none;
      margin-top: 0.5rem;
      border-radius: 4px;
    }

    /* Goals Section */
    .goals-section {
      margin-bottom: 2rem;
    }

    .goal-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-small);
      transition: all 0.3s ease;
    }

    .goal-row:hover {
      background: rgba(124, 131, 253, 0.05);
      transform: translateX(4px);
    }

    .goal-row.checked {
      opacity: 0.6;
      background: rgba(148, 163, 184, 0.1);
    }

    .goal-row.checked input[type="text"] {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .goal-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--accent-primary);
      cursor: pointer;
    }

    .goal-row input[type="text"] {
      flex: 1;
      border: none;
      background: transparent;
      font-size: 1rem;
      color: var(--text-primary);
      outline: none;
      padding: 0.25rem;
    }

    .goal-row input[type="text"]:focus {
      background: rgba(124, 131, 253, 0.1);
      border-radius: 4px;
    }

    .goal-row input[type="text"]::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }

    .goal-row input[type="number"] {
      width: 60px;
      padding: 0.25rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      text-align: center;
      background: var(--card-bg);
      color: var(--text-primary);
    }

    .goal-row .time-label {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .goal-row .remove-btn {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.25rem;
      border-radius: 4px;
      transition: all 0.2s ease;
      opacity: 0;
    }

    .goal-row:hover .remove-btn {
      opacity: 1;
    }

    .goal-row .remove-btn:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .add-goal-btn {
      width: 100%;
      padding: 0.75rem;
      background: none;
      border: 2px dashed var(--border-color);
      border-radius: var(--border-radius-small);
      color: var(--text-secondary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .add-goal-btn:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      background: rgba(124, 131, 253, 0.05);
    }

    /* Focus Blocks Section */
    .focus-blocks {
      margin-top: 2rem;
    }

    .block-controls {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }

    .block-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-small);
      background: var(--secondary-bg);
      color: var(--text-primary);
      font-size: 1rem;
      outline: none;
      transition: all 0.2s ease;
    }

    .block-input:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(124, 131, 253, 0.1);
    }

    .block-input::placeholder {
      color: var(--text-muted);
    }

    .block-item {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-small);
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: all 0.2s ease;
    }

    .block-item:hover {
      background: rgba(124, 131, 253, 0.05);
      transform: translateX(4px);
    }

    .block-item.unlabeled {
      opacity: 0.7;
      font-style: italic;
      border-style: dashed;
    }

    .block-time {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .block-label {
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Help Section */
    .help-section {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-left: 4px solid var(--accent-primary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: var(--shadow-light);
    }

    .help-toggle {
      cursor: pointer;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--text-primary);
      outline: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .help-content {
      margin-top: 1rem;
      line-height: 1.7;
      color: var(--text-secondary);
      text-align: left;
    }

    .help-content ul {
      padding-left: 1.2rem;
    }

    .help-content li {
      margin-bottom: 0.75rem;
    }

    .help-content a {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 500;
    }

    .help-content a:hover {
      text-decoration: underline;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .theme-selector {
        position: relative;
        top: 0;
        right: 0;
        margin-bottom: 1rem;
        justify-content: center;
      }

      .main-container {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }

      .timer-section {
        position: static;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 0.5rem;
      }

      .theme-selector {
        padding: 0.5rem;
        gap: 0.25rem;
      }

      .theme-btn {
        width: 35px;
        height: 35px;
      }

      .theme-btn::before {
        width: 16px;
        height: 16px;
      }

      .card {
        padding: 1.5rem;
      }

      .circle-timer {
        width: 200px;
        height: 200px;
      }

      .timer-display {
        font-size: 2rem;
      }

      .button-group {
        flex-direction: column;
        width: 100%;
      }

      .btn {
        width: 100%;
      }

      .block-controls {
        flex-direction: column;
      }

      .block-input {
        width: 100%;
      }
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .timer-running .timer-display {
      animation: pulse 2s infinite;
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <!-- Theme Selector -->
  <div class="theme-selector">
    <button class="theme-btn active" data-theme="teal" onclick="setTheme('teal')" title="Teal Ocean"></button>
    <button class="theme-btn" data-theme="pink" onclick="setTheme('pink')" title="Pink Sunset"></button>
    <button class="theme-btn" data-theme="brown" onclick="setTheme('brown')" title="Warm Brown"></button>
  </div>

  <div class="main-container">
    <!-- Timer Section -->
    <div class="timer-section">
      <div class="card">
        <div class="card-title">🍅 Pomodoro Timer</div>
        
        <div class="timer-status" id="status">Focus time – let's go!</div>
        
        <div class="circle-timer">
          <div class="timer-display" id="timerDisplay">25:00</div>
        </div>
        
        <div class="controls">
          <div class="button-group">
            <button class="btn btn-primary" onclick="startTimer()">▶ Start</button>
            <button class="btn" onclick="pauseTimer()">⏸ Pause</button>
            <button class="btn" onclick="resetTimer()">⏹ Reset</button>
          </div>
          
          <select class="select-input" id="focusDuration" onchange="setFocusDuration(this.value)">
            <option value="25">25 minutes</option>
            <option value="50">50 minutes</option>
            <option value="90">90 minutes</option>
          </select>
          
          <select class="select-input" id="ambientSelect" onchange="changeAmbient(this.value)">
            <option value="">🔇 No Sound</option>
            <option value="fire1">🔥 Blazing Fireplace</option>
            <option value="fire2">🔥 Crackling Campfire</option>
            <option value="waterfall">💧 River Rapids</option>
            <option value="train">🚂 Train Journey</option>
            <option value="airplane">✈️ Airplane Cabin</option>
            <option value="snowfall">❄️ Snowfall & Wind</option>
            <option value="rainforest">🌿 Rainforest</option>
            <option value="rain">🌧️ Gentle Rain</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Content Section -->
    <div class="content-section">
      <!-- Help Section -->
      <div class="help-section">
        <details>
          <summary class="help-toggle">💡 How to Use This Timer</summary>
          <div class="help-content">
            <ul>
              <li>This is a Pomodoro timer ⏱️! You can adjust your focus session to 25, 50, or 90 minutes. 5-minute short breaks and a 30-minute long break after 4 focus sessions.</li>
              <li>Choose from various ambient sounds to help you focus. You'll find quick options in the dropdown, or expand "More Ambient Sounds" for extended tracks from <a href="https://archive.org/details/relaxingsounds/" target="_blank">archive.org</a>.</li>
              <li>Add goals for the day and break tasks into small chunks to make them easier to tackle. Add time estimates and check them off ✅ when you're done.</li>
              <li>After each focus session, label what you actually worked on in the "Today's Focus Blocks" section - even if you got distracted! This helps track habits over time.</li>
              <li>Good luck with your work today! 🚀</li>
            </ul>
          </div>
        </details>
      </div>

      <!-- Goals Section -->
      <div class="card goals-section">
        <div class="card-title">📋 Today's Goals</div>
        <div id="goalList"></div>
        <button class="add-goal-btn" onclick="addGoal()">+ Add Goal</button>
      </div>

      <!-- Focus Blocks Section -->
      <div class="card focus-blocks">
        <div class="card-title">⏰ Today's Focus Blocks</div>
        <div class="block-controls">
          <input type="text" class="block-input" id="taskInput" placeholder="What did you work on?">
          <button class="btn btn-primary" onclick="labelLastBlock()">Label Block</button>
        </div>
        <div id="logList"></div>
      </div>
    </div>
  </div>

  <script>
    // Timer variables
    let currentTime = 25 * 60; // 25 minutes in seconds
    let isRunning = false;
    let isPaused = false;
    let timerInterval = null;
    let currentPhase = 'focus'; // 'focus', 'break', 'longBreak'
    let completedPomodoros = 0;
    let sessionLog = [];

    // Audio for notifications
    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+H0+Q==');

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateDisplay();
      loadGoals();
      loadBlocks();
      loadTheme();
    });

    // Theme functions
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('pomodoro-theme', theme);
      
      // Update active theme button
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('pomodoro-theme') || 'teal';
      setTheme(savedTheme);
    }

    // Timer functions
    function startTimer() {
      if (!isRunning) {
        isRunning = true;
        document.body.classList.add('timer-running');
        timerInterval = setInterval(tick, 1000);
        updateStatus();
      }
    }

    function pauseTimer() {
      if (isRunning) {
        isRunning = false;
        isPaused = true;
        clearInterval(timerInterval);
        document.body.classList.remove('timer-running');
        updateStatus();
      }
    }

    function resetTimer() {
      isRunning = false;
      isPaused = false;
      clearInterval(timerInterval);
      document.body.classList.remove('timer-running');
      
      const focusDuration = parseInt(document.getElementById('focusDuration').value);
      currentTime = focusDuration * 60;
      currentPhase = 'focus';
      
      updateDisplay();
      updateStatus();
    }

    function tick() {
      if (currentTime > 0) {
        currentTime--;
        updateDisplay();
      } else {
        // Timer finished
        audio.play();
        completeSession();
      }
    }

    function completeSession() {
      isRunning = false;
      clearInterval(timerInterval);
      document.body.classList.remove('timer-running');
      
      // Log the completed session
      const now = new Date();
      const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      if (currentPhase === 'focus') {
        completedPomodoros++;
        const duration = parseInt(document.getElementById('focusDuration').value);
        sessionLog.push({
          time: timeString,
          duration: duration,
          label: '',
          type: 'focus'
        });
        
        // Switch to break
        if (completedPomodoros % 4 === 0) {
          currentPhase = 'longBreak';
          currentTime = 30 * 60; // 30 minutes
        } else {
          currentPhase = 'break';
          currentTime = 5 * 60; // 5 minutes
        }
      } else {
        // Break finished, back to focus
        currentPhase = 'focus';
        const focusDuration = parseInt(document.getElementById('focusDuration').value);
        currentTime = focusDuration * 60;
      }
      
      updateDisplay();
      updateStatus();
      saveBlocks();
      loadBlocks();
    }

    function updateDisplay() {
      const minutes = Math.floor(currentTime / 60);
      const seconds = currentTime % 60;
      const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('timerDisplay').textContent = display;
    }

    function updateStatus() {
      const statusEl = document.getElementById('status');
      
      if (isRunning) {
        if (currentPhase === 'focus') {
          statusEl.textContent = '🎯 Focus Time - Stay Concentrated!';
        } else if (currentPhase === 'break') {
          statusEl.textContent = '☕ Short Break - Relax a Bit!';
        } else {
          statusEl.textContent = '🏖️ Long Break - Well Deserved!';
        }
      } else if (isPaused) {
        statusEl.textContent = '⏸️ Paused - Ready to Continue?';
      } else {
        statusEl.textContent = '🍅 Ready to Focus - Let\'s Go!';
      }
    }

    function setFocusDuration(minutes) {
      if (!isRunning) {
        currentTime = minutes * 60;
        updateDisplay();
      }
    }

    // Ambient sound functions
    let currentAudio = null;
    
    function changeAmbient(type) {
      // Stop current audio if playing
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }
      
      if (type) {
        const ambientUrls = {
          'fire1': 'https://archive.org/download/relaxingsounds/FIRE%202%203h%20Blazing%20Fireplace.mp3',
          'fire2': 'https://archive.org/download/relaxingsounds/FIRE%201%2010h%20CracklingCampfire%2CCrickets%2CRainOrRiver-Night.mp3',
          'waterfall': 'https://archive.org/download/relaxingsounds/Falls%201%209h%20River%20Rapids(High%20pitch)%2CLiteSplashing.mp3',
          'train': 'https://archive.org/download/relaxingsounds/Train%203%209h%20Med.LiteRumble-NoHornsOrBells.mp3',
          'airplane': 'https://archive.org/download/relaxingsounds/Wind%201%208h%20(or%20Rapids)%20Gentle%2CLowPitch%2CBrownNoise.mp3',
          'snowfall': 'https://archive.org/download/relaxingsounds/Snowfall%20%26%20Wind(Lite)%2010h%20Dusk%20into%20Night-Forest.mp3',
          'rainforest': 'https://archive.org/download/relaxingsounds/Snowfall%20%26%20Wind(Lite)%2010h%20Dusk%20into%20Night-Forest.mp3',
          'rain': 'https://archive.org/download/relaxingsounds/Rain%207%20(Lightest)%208h%20DripsOnTrees-no%20thunder.mp3'
        };
        
        if (ambientUrls[type]) {
          currentAudio = new Audio(ambientUrls[type]);
          currentAudio.loop = true;
          currentAudio.volume = 0.3;
          currentAudio.play().catch(e => console.log('Audio play failed:', e));
        }
      }
    }

    function toggleAmbientList() {
      const grid = document.getElementById('ambientGrid');
      const toggle = document.querySelector('.ambient-toggle');
      const isVisible = grid.style.display === 'grid';
      
      grid.style.display = isVisible ? 'none' : 'grid';
      toggle.innerHTML = isVisible ? 
        '🎧 More Ambient Sounds 🔽' : 
        '🎧 Hide Ambient Sounds 🔼';
    }

    // Goals functions
    function addGoal() {
      const goalList = document.getElementById('goalList');
      const goalRow = document.createElement('div');
      goalRow.className = 'goal-row fade-in';
      
      goalRow.innerHTML = `
        <input type="checkbox" onchange="toggleGoal(this)">
        <input type="text" placeholder="Enter your goal..." onkeypress="handleGoalKeypress(event, this)">
        <input type="number" placeholder="25" min="1" max="999">
        <span class="time-label">min</span>
        <button class="remove-btn" onclick="removeGoal(this)">×</button>
      `;
      
      goalList.appendChild(goalRow);
      goalRow.querySelector('input[type="text"]').focus();
      saveGoals();
    }

    function toggleGoal(checkbox) {
      const row = checkbox.parentElement;
      row.classList.toggle('checked', checkbox.checked);
      saveGoals();
    }

    function removeGoal(button) {
      button.parentElement.remove();
      saveGoals();
    }

    function handleGoalKeypress(event, input) {
      if (event.key === 'Enter') {
        input.blur();
        saveGoals();
      }
    }

    function saveGoals() {
      const goals = [];
      document.querySelectorAll('.goal-row').forEach(row => {
        const checkbox = row.querySelector('input[type="checkbox"]');
        const textInput = row.querySelector('input[type="text"]');
        const numberInput = row.querySelector('input[type="number"]');
